@using System.Linq
@using MrCMS.Helpers
@model dynamic
@{
    ViewBag.Title = "Import / Export Products";
    var warehouseStockEnabled = (bool)ViewData["warehousestockenabled"];
}
<fieldset>
    <legend>
        Import / Export Products
    </legend>

    <a href="@Url.Action("ExportProducts", "ImportExport")" class="btn btn-primary">Export to Excel</a>

    @if (warehouseStockEnabled)
    {
        <p class="clearfix" />
        @Html.InfoBlock(Resource("Heads up!"), Resource("Ecommerce Product Export Warehouse Enabled", "You have warehouse stock enabled. The stock column in this export will be a sum of all available stock. When importing, the stock levels will not be effected."), AlertType.warning)
    }
    <div class="clearfix"></div>

    @if (ViewBag.ExportStatus != null)
    {
        <br />
        <span class="alert alert-info">@ViewBag.ExportStatus</span>
        <div class="clearfix"></div>
    }
    <hr />

    @Html.InfoBlock(Resource("Heads up!"), Resource("Ecommerce Product Import Info", "Import File must be in .xslx format. After clicking on \"Import Products\" any new products inside file will be added to database and existing ones will be updated with provided values in file."))


    <div class="clearfix"></div>
    @using (Html.BeginForm("ImportProducts", "ImportExport", FormMethod.Post, new { enctype = "multipart/form-data" }))
    {
        <label>Choose Import File</label>
        <input type="file" name="document" id="document" />
        <div class="clearfix"></div>
        <br />
        if (ViewBag.Messages != null)
        {
            foreach (var item in (Dictionary<string, List<string>>)ViewBag.Messages)
            {
                <span>
                    <strong>@item.Key</strong> has the following errors:
                </span>
                <ul>
                    @foreach (string error in (List<string>)item.Value)
                    {
                        <li>
                            @error
                        </li>
                    }
                </ul>
            }
            if (!((Dictionary<string, List<string>>)ViewBag.Messages).Any())
            {
                <div class="alert alert-success">
                    All products and variants were successfully imported.
                </div>
            }
        }
        if (ViewBag.ImportStatus != null)
        {
            <div class="alert alert-warning">@ViewBag.ImportStatus</div>
            <div class="clearfix"></div>
        }

        <input type="submit" class="btn btn-primary" value="Import" />
    }
</fieldset>