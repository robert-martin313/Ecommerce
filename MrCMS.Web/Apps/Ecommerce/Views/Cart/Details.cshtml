@using MrCMS.Helpers
@using MrCMS.Web.Apps.Ecommerce.Settings
@using MrCMS.Web.Apps.Ecommerce.Helpers
@model MrCMS.Web.Apps.Ecommerce.Models.CartModel
<div id="details">
    <div class="row-fluid">
        <div class="span6">
            <h1>Shopping Basket</h1>
        </div>
        <div class="span6">
            <div class="row-fluid">
                <a class="btn offset4 span4" href="@(UniquePageHelper.GetUrl<MrCMS.Web.Apps.Ecommerce.Pages.ProductSearch>())">Continue Shopping</a>
                @if (Model.CanEnterPaymentFlow)
                {
                    <a class="btn btn-info span4" href="@(UniquePageHelper.GetUrl<MrCMS.Web.Apps.Ecommerce.Pages.EnterOrderEmail>())">Pay Securely NOW!</a>
                }
            </div>
        </div>
    </div>
    <div class="row-fluid cart" id="cart-items">
        @if (Model.Items.Any())
        {
            <div class="row-fluid cart-heading-row" id="header">
                <div class="span4 padding-left-5">
                    Item Description
                </div>
                <div class="span2">
                    Your Options
                </div>
                <div class="span2 text-center">
                    Quantity
                </div>
                <div class="span2 text-right">
                    Price
                </div>
                <div class="span2 text-right padding-right-5">
                    Total
                </div>
            </div>
            foreach (var item in Model.Items)
            {
                Html.RenderPartial("CartItem", item);
            }
        }
        else
        {
            <span>No items in basket.</span>
        }
    </div>
    @if (Model.Items.Any())
    {
        <div class="row-fluid">
            <div class="offset6 span6">
                <button type="button" class="btn offset4 span4" id="update-basket">Update Basket</button>
                <button type="button" class="btn btn-danger span4" id="empty-basket">Empty Basket</button>
            </div>
        </div>

        <div class="row-fluid cart-discount-container" id="cart-discount">
            <div class="offset6 span6">
                @Html.HiddenFor(x => x.DiscountCode)
                <div class="row-fluid" id="discount-code-box">
                    <div class="span4 discount-header">Discount Code</div>
                    <div class="span4">
                        <input class="span12" type="text" id="discount-code" />
                    </div>
                    <div class="span4 padding-right-5">
                        <button id="apply-discount-code" class="btn span12">Apply Discount Code</button>
                    </div>
                </div>
            </div>
        </div>
    }
    <div class="row-fluid">
        <div class="span6">
        </div>
        <div class="span6" id="cart-summary">
            @if (Model.Items.Any())
            {
                <div class="row-fluid">
                    <div class="span6">Subtotal before delivery charges</div>
                    <div class="span6 text-right">@Model.Subtotal.ToCurrencyFormat()</div>
                </div>
                if (Model.HasDiscount)
                {
                <div class="row-fluid">
                    <div class="span6">Discount</div>
                    <div class="span6 text-right">@((-Model.OrderTotalDiscount).ToCurrencyFormat())
                    </div>
                </div>
                }
                if (MrCMS.Website.MrCMSApplication.Get<TaxSettings>().TaxesEnabled)
                {
                <div class="row-fluid">
                    <div class="span6">VAT</div>
                    <div class="span6 text-right">@Model.Tax.ToCurrencyFormat()
                    </div>
                </div>
                }
                <div class="row-fluid">
                    <div class="span6">
                        @Html.DropDownList("ShippingCalculation", ViewData["shipping-calculations"] as IEnumerable<SelectListItem>, new { @class = "input-xlarge" })
                    </div>
                    <div class="span6 text-right">
                        @if (Model.ShippingTotal.HasValue)
                        {
                            @Model.ShippingTotal.Value.ToCurrencyFormat()
                        }
                        else
                        {
                            <span>Please choose a shipping method</span>
                        }
                    </div>
                </div>
                <div class="total-divider"></div>
                <div>
                    <div class="span6">Total</div>
                    <div class="text-right total">@Model.Total.ToCurrencyFormat()</div>
                </div>
            }
        </div>
    </div>
    <div class="row-fluid">
        <div class="offset6 span6">
            @if (Model.CanEnterPaymentFlow)
            {
                <a class="btn btn-info offset8 span4" href="@(UniquePageHelper.GetUrl<MrCMS.Web.Apps.Ecommerce.Pages.EnterOrderEmail>())">Pay Securely NOW!</a>
            }
            @if (Model.CanUsePayPalExpress)
            {
                using (Html.BeginForm("SetExpressCheckout", "PayPalExpressCheckout", FormMethod.Post))
                {
                    <div class="text-right">
                        <p>or</p>
                        <input class="btn-paypal" type="image" src="https://www.paypalobjects.com/en_GB/i/btn/btn_xpressCheckout.gif" />
                    </div>
                }
            }
        </div>
    </div>
</div>
@{ Html.IncludeScript("~/Apps/Ecommerce/Content/Scripts/custom/cart.js"); }