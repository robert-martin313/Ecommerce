@using MrCMS.Helpers
@using MrCMS.Web.Apps.Ecommerce.Models
@model MrCMS.Web.Apps.Ecommerce.Pages.PaymentDetails
@{ var cart = ViewData["cart"] as CartModel;}
@{ var settingBillingAddress = ViewData["setting-billing-address"] is bool && (bool)ViewData["setting-billing-address"];}

<div class="row-fluid">
    <div class="span8">
        <h4>Billing Address</h4>
        @if (cart.BillingAddressSameAsShippingAddress)
        {
            using (Html.BeginForm("BillingAddressSameAsShippingAddress", "PaymentDetails", FormMethod.Post, new { @class = "form-horizontal" }))
            {
            <div class="control-group">
                <div class="control-label">
                    <label class="checkbox" for="SameAsShipping">
                        Use Delivery Address @Html.CheckBox("SameAsShipping", cart.BillingAddressSameAsShippingAddress)</label>
                </div>
                <div class="controls">
                    @cart.ShippingAddress.GetDescription()
                </div>
            </div>
            }
        }
        @if (settingBillingAddress)
        {
            Html.RenderAction("SetBillingAddress", "PaymentDetails");
        }
        else if (!cart.BillingAddressSameAsShippingAddress && cart.BillingAddress != null)
        {
            <div class="form-horizontal">
                <div class="control-group">
                    <div class="control-label">Billing Address :</div>
                    <div class="controls">
                        @cart.BillingAddress.GetDescription()
                    </div>
                </div>    
            </div>
            using (Html.BeginForm("UpdateBillingAddress", "PaymentDetails", FormMethod.Post, new { @class = "form-horizontal" }))
            {
                <div class="control-group">
                    <div class="controls">
                        <input class="btn btn-info" value="Edit" type="submit" />
                    </div>
                </div>
            }
        }
        <hr/>
        <h4>Payment Details</h4>
        @if (!settingBillingAddress)
        {
            Html.RenderPartial("SelectMethod", cart);
            <div id="payment-confirmation">
                @if (!string.IsNullOrWhiteSpace(cart.PaymentMethod))
                {
                    Html.RenderAction(cart.PaymentMethod, "PaymentMethod");
                }
            </div>
        }
        else
        {
            <p>Select after updating billing address...</p>
        }
    </div>
    <div class="span4">
        @{Html.RenderAction("Summary", "Checkout");}
        <hr />
        @{Html.RenderAction("OrderEmail", "Checkout");}
        <hr />
        @{Html.RenderAction("DeliveryDetails", "Checkout");}
    </div>
</div>

@{ Html.IncludeScript("~/Apps/Ecommerce/Content/Scripts/custom/payment-details.js"); }

