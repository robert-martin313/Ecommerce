@using MrCMS.Helpers
@using MrCMS.Web.Apps.Ecommerce.Models
@model MrCMS.Web.Apps.Ecommerce.Pages.PaymentDetails
@{ var cart = ViewData["cart"] as CartModel;}
@{ var settingBillingAddress = ViewData["setting-billing-address"] is bool && (bool)ViewData["setting-billing-address"];}

<div class="padding-top-bottom-20">
    <div class="row">
        <div class="col-md-8 col-sm-8 padding-left-0">
            <div class="block-title">
                <h1>Billing Address</h1>
            </div>
            @if (cart.RequiresShipping && cart.BillingAddressSameAsShippingAddress)
            {
                using (Html.BeginForm("BillingAddressSameAsShippingAddress", "PaymentDetails", FormMethod.Post, new { @class = "form-horizontal" }))
                {
                    <div class="checkbox">
                        <label>
                            Use Delivery Address @Html.CheckBox("SameAsShipping", cart.BillingAddressSameAsShippingAddress)
                            @cart.ShippingAddress.GetDescription()
                        </label>
                    </div>
                }
            }

            @if (settingBillingAddress)
            {
                Html.RenderAction("SetBillingAddress", "PaymentDetails");
            }
            else if (!cart.BillingAddressSameAsShippingAddress && cart.BillingAddress != null)
            {
                <div class="margin-bottom-10">
                    <label>
                        Billing Address :
                    </label>
                    @cart.BillingAddress.GetDescription()
                </div>
                
                using (Html.BeginForm("UpdateBillingAddress", "PaymentDetails", FormMethod.Post, new { @class = "form-horizontal" }))
                {
                    <input class="btn btn-default" value="Edit" type="submit" />
                }
            }

            <br/>

            <div class="block-title">
                <div class="h1style">Payment Details</div>
            </div>
            @if (!settingBillingAddress)
            {
                Html.RenderPartial("SelectMethod", cart);
                <div id="payment-confirmation">
                    @if (!string.IsNullOrWhiteSpace(cart.PaymentMethod))
                    {
                        Html.RenderAction(cart.PaymentMethod, "PaymentMethod");
                    }
                </div>
            }
            else
            {
                <p>Select after updating billing address...</p>
            }
        </div>
        <div class="col-md-4 col-sm-4">
            @{Html.RenderAction("Summary", "Checkout");}
            @{Html.RenderAction("OrderEmail", "Checkout");}
            @if (cart.RequiresShipping)
            {
                Html.RenderAction("DeliveryDetails", "Checkout");
            }
        </div>
    </div>
</div>

@{ Html.IncludeScript("~/Apps/Ecommerce/Content/Scripts/custom/payment-details.js"); }

