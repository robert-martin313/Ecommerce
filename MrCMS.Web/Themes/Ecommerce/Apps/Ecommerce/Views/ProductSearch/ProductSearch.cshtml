@model MrCMS.Web.Apps.Ecommerce.Pages.ProductSearch
@using MrCMS.Helpers

<ul class="breadcrumb">
<li><a href="#">Home</a> <span class="divider">/</span></li>
<li class="active">Products</li>
</ul>
@RenderZone("Before Content")

<div class="row-fluid">
    <div class="span3">
        <div class="product-filter-box-title">
            Filter by Category
        </div>
        <div class="row-fluid">
          <ul class="nav nav-tabs nav-stacked return-delivery-box">
                @foreach (var item in (List<MrCMS.Web.Apps.Ecommerce.Pages.Category>)ViewBag.Categories)
                {
                     <li>
                        <a href="/@item.LiveUrlSegment">@item.Name <i class="icon-chevron-right pull-right"></i></a>
                    </li>
                }
          </ul>
        </div>
        <br />
        <div class="product-filter-box-title">
            Filter by Price
        </div>
        <div class="row-fluid">
            @Html.Hidden("product-price-range-min",(Int32)ViewBag.ProductPriceRangeMin)
            @Html.Hidden("product-price-range-max",(Int32)ViewBag.ProductPriceRangeMax)
            Price range from &pound;@ViewBag.ProductPriceRangeMin - &pound;@ViewBag.ProductPriceRangeMax
          <div id="slider-range" class="product-filter-box-slider"></div>
        </div>
        <br />
        <div class="product-filter-box-title">
            Filter by Options
        </div>
        <div class="row-fluid">
            <ul id="product-filter-box-options" class="nav nav-tabs nav-stacked return-delivery-box">
           @foreach (var option in (List<MrCMS.Web.Apps.Ecommerce.Entities.Products.ProductAttributeOption>)ViewBag.ProductOptions)
           {
               if (option.Values.Select(x => x.Value).Distinct().Count() > 0)
               {
                <li>
                        <a>
                        @option.Name
                        <br/>
                        <select id="@(Html.Encode("product-option-values-"+option.Name))" class="span12">
                        @foreach (var optionValue in option.Values.Select(x=>x.Value).Distinct())
                        {
                                <option value="@(optionValue)">@optionValue</option>
                        }
                        </select>
                        </a>
                </li>
                } 
           }
           </ul>
           </div>
         <br />
        <div class="product-filter-box-title">
            Filter by Specifications
        </div>
        <div class="row-fluid">
            <ul id="product-filter-box-specifications" class="nav nav-tabs nav-stacked return-delivery-box">
           @foreach (var specification in (List<MrCMS.Web.Apps.Ecommerce.Entities.Products.ProductSpecificationAttribute>)ViewBag.ProductSpecifications)
           {
               if(specification.Values.Select(x=>x.Value).Distinct().Count()>0)
               {
               <li>
                        <a>
                        @specification.Name
                        <br/>
                        <select id="@(Html.Encode("product-specification-values-"+specification.Name))" class="span12">
                        @foreach (var specificationValue in specification.Values.Select(x=>x.Value).Distinct())
                        {
                                <option value="@(specificationValue)">@specificationValue</option>
                        }
                        </select>
                        </a>
                </li>
              }
           }
           </ul>
           </div>
    </div>
    <div class="span9">
            @if (((MrCMS.Paging.IPagedList<MrCMS.Web.Apps.Ecommerce.Pages.Product>)ViewBag.Products).Count() > 0)
            {
                <div id="products-operations">
                <div id="stats" class="pull-left">Showing 1 - 12 of @(((MrCMS.Paging.IPagedList<MrCMS.Web.Apps.Ecommerce.Pages.Product>)ViewBag.Products).Count())</div>
                <div id="show" class="pull-right">
                    <label>Show</label>
                     <select class="pull-right" id="options">
                         <option value="6">6 products per page</option>
                     </select>
                </div>
                <div id="sorting" class="pull-right">
                    <label>Sort by</label>
                     <select class="pull-right" id="product-sorting-options">
                         <option value="1">Most popular</option>
                     </select>
                </div>
                 </div>
                <div class="clearfix"></div>
                <div id="products row-fluid">
                     @foreach (var item in (MrCMS.Paging.IPagedList<MrCMS.Web.Apps.Ecommerce.Pages.Product>)ViewBag.Products)
                      {
                          <div class="item">
                                <div class="span3" style="height:200px; overflow:hidden;">
                                @if(item.Images.Count()>0)
                                {
                                     <img src="@(item.Images.First<MrCMS.Entities.Documents.Media.MediaFile>().FileUrl)" class="img-rounded pull-left span12" />
                                }
                                </div>
                                <div class="span6">
                                    <h4><a href="/@item.LiveUrlSegment">@item.Name</a></h4>
                                    @(item.Abstract.Length>255?item.Abstract.Substring(0,250)+"...":item.Abstract)
                                </div>
                                <div class="span3">
                                    <div class="pull-right">
                                    Exclusive price
                                     <h1 class="product-price">
                                                    @if (item.PricePreTax == 0 && item.Variants.Count>0)
                                                    {
                                                        @Html.Raw("&pound;"+item.Variants.OrderBy(x=>x.Price).First<MrCMS.Web.Apps.Ecommerce.Entities.Products.ProductVariant>().Price.ToString())
                                                    }
                                                    else
                                                    {
                                                        @Html.Raw("&pound;"+item.PricePreTax.ToString());
                                                    }
                                      </h1>
                                     shop price <span style="text-decoration:line-through">&pound;@(item.PreviousPrice.HasValue?item.PreviousPrice.Value.ToString("#.##"):"")</span>
                                     <br /><br />
                                     <button class="btn btn-info span12" type="button">More info</button>
                                        </div>
                                  </div>
                              <div class="clearfix"></div>
                         </div>
                     }
                </div>
                <div id="products-paging">
                    @Html.Pager((MrCMS.Paging.IPagedList<MrCMS.Web.Apps.Ecommerce.Pages.Product>)ViewBag.Products, "ProductSearch", i => new { page = i })
                </div>
            }
    </div>
</div>

@{ Html.IncludeScript("~/Themes/Ecommerce/Apps/Ecommerce/Content/Scripts/custom/product-search.js"); }