@using MrCMS.Helpers
@using MrCMS.Web.Apps.Ecommerce.Entities.Products
@using MrCMS.Web.Apps.Ecommerce.Models
@using MrCMS.Web.Apps.Ecommerce.Pages
@using MrCMS.Web.Apps.Ecommerce.Services.Products
@model MrCMS.Web.Apps.Ecommerce.Services.Products.ProductSearchQuery
@{
    var categories = ViewData["categories"] as CategorySearchModel;
    var options = ViewData["product-options"] as List<ProductOptionModel>;
    var specifications = ViewData["product-specifications"] as List<ProductOptionModel>;
    var brands = ViewData["product-brands"] as List<SelectListItem>;
}
<div id="product-query-container" class="row-fluid block padding-bottom-10">
    <div class="span12">
        <div class="block-header hidden-phone">
            Refine Results
        </div>
        <a class="btn btn-navbar hidden-tablet hidden-desktop" data-toggle="collapse" data-target="#filter">
            <span class="pull-left">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </span>
            <span class="pull-left refine">Filter Results</span>
            <div class="clearfix"></div>
        </a>
        <div class="collapse" id="filter">
            @if (categories.Any())
            {
                <div class="filter-header">
                    By Category
                </div>
                <div class="block-list">
                    @Html.HiddenFor(query => query.CategoryId)
                    <ul class="">
                        @{ var depth = 0; }
                        @if (categories.Hierarchy.Any())
                        {
                            <li>
                                <a href="@(UniquePageHelper.GetUrl<ProductSearch>())">Products</a>
                            </li>
                            depth++;
                        }
                        @foreach (var parent in categories.Hierarchy)
                        {
                            <li>
                                <a href="/@parent.LiveUrlSegment">@string.Format("{0} {1}", new string('-', depth), parent.Name)</a>
                            </li>
                            depth++;
                        }
                        @foreach (var item in categories.Children)
                        {
                            <li>
                                <a href="/@item.LiveUrlSegment">@string.Format("{0} {1}", new string('-', depth), item.Name)</a>
                            </li>
                        }
                    </ul>
                </div>
            }
            @{ Html.RenderPartial("SearchOptions", new ViewDataDictionary(options) { { "query", Model } }); }
            <div class="filter-header">
                By Price
            </div>
            <div class="block-container padding-left-right-10">
                <div class="row-fluid dashed-border-bottom">
                    @Html.HiddenFor(query => query.PriceFrom)
                    @Html.Hidden("PriceTo", Model.PriceTo ?? Model.MaxPrice)
                    @Html.HiddenFor(query => query.MaxPrice)
                    <span id="amount"></span>
                    <div id="slider-range"></div>
                    <br />
                </div>
            </div>
            @{ Html.RenderPartial("SearchSpecifications", new ViewDataDictionary(specifications) { { "query", Model } }); }
            @{ Html.RenderPartial("SearchBrands", new ViewDataDictionary(brands) { { "query", Model } }); }
        </div>
@*        <div class="row-fluid side-teaser hidden-phone">
            <a href="/delivery-details"><img src="/Themes/Ryness/Content/Images/free-delivery-small.jpg" alt="Free delivery on orders over &pound;50" title="Free delivery on orders over &pound;50" /></a>
        </div>
        <div class="row-fluid side-teaser hidden-phone">
            <a href="/returns-policy"><img src="/Themes/Ryness/Content/Images/return-small.jpg" alt="7 day no question returns" title="7 day no question returns" /></a>
        </div>*@
    </div>
</div>