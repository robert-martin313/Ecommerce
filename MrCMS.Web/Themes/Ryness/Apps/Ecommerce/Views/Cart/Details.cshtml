@using MrCMS.Helpers
@using MrCMS.Web.Apps.Ecommerce.Settings
@using MrCMS.Web.Apps.Ecommerce.Helpers
@model MrCMS.Web.Apps.Ecommerce.Models.CartModel
<div id="details" class="container">
    <h1>Shopping basket summary</h1>
    <hr/>

    <div class="row-fluid">
        <div class="span2">
            <a class="btn span12" href="@(UniquePageHelper.GetUrl<MrCMS.Web.Apps.Ecommerce.Pages.ProductSearch>())">Continue Shopping</a>
        </div>
        <div class="span8">
            <a href="#"><i class="icon-print"></i>Print shopping basket</a>
        </div>
        <div class="span2 text-align-center">
            @if (Model.CanEnterPaymentFlow)
            {
                <a class="generic-button big-red-gradient span12" href="@(UniquePageHelper.GetUrl<MrCMS.Web.Apps.Ecommerce.Pages.EnterOrderEmail>())">Checkout</a>
            }
        </div>
    </div>

    <div class="row-fluid padding-top-bottom-10" id="cart-items">
        <div class="span12">
            @if (Model.Items.Any())
            {
                <div class="row-fluid cart-header" id="header">
                    <div class="span8 cart-border-right">
                        Product
                    </div>
                    <div class="span2 cart-border-right">
                        Your Options
                    </div>
                    <div class="span2">
                        Price
                    </div>
                </div>
                foreach (var item in Model.Items)
                {
                    Html.RenderPartial("CartItem", item);
                }
            }
            else
            {
                <span>No items in shopping basket.</span>
            }
        </div>
    </div>

    @if (Model.Items.Any())
    {
        <div class="row-fluid padding-top-bottom-15">
            <div class="span8 cart-discount padding-top-bottom-25">
                <div class="row-fluid" id="cart-discount" style="padding-right:25px;padding-left:25px;">
                    <h1>Promotion Code</h1>
                    <p>If you have a promotion code or student card please enter it here:</p>
                    @Html.HiddenFor(x => x.DiscountCode)
                    <div class="title">Discount Code</div>
                    <div id="discount-code-box" class="row-fluid">
                        <div class="span8">
                            <input type="text" id="discount-code" class="span12"/>
                        </div>
                        <div class="span4">
                            <button id="apply-discount-code" class="btn span8">Apply Code</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="span4 cart-summary padding-top-bottom-25" style="padding-right:18px;padding-left:18px;" id="cart-summary">
                <div class="text-align-right">
                    @if (Model.Items.Any())
                    {
                        <div class="cart-subtotal">Subtotal before Delivery : @Model.Subtotal.ToCurrencyFormat()</div>
                        if (Model.HasDiscount)
                        {
                            <div class="cart-discount">Discount (@Model.DiscountCode) : @((-Model.DiscountAmount).ToCurrencyFormat())</div>
                        }
                        if (MrCMS.Website.MrCMSApplication.Get<TaxSettings>().TaxesEnabled)
                        {
                            <div class="cart-taxes">VAT : @Model.Tax.ToCurrencyFormat()</div>
                        }
                        <div class="">
                            @Html.DropDownList("ShippingCalculation", ViewData["shipping-calculations"] as IEnumerable<SelectListItem>, new { @class = "span12", @style = "margin-bottom:0;" })                        
                        </div>
                        <div class="cart-shipping">
                            @if (Model.ShippingTotal.HasValue)
                            {
                                <span>Shipping : </span>@Model.ShippingTotal.Value.ToCurrencyFormat()
                            }
                            else
                            {
                                <span>Please choose a shipping method</span>
                            }
                        </div>
                        <div class="cart-total">
                            <h1>Total Cost : @Model.Total.ToCurrencyFormat()</h1>
                        </div>
                    }
                </div>
                <div class="row-fluid">
                    <div class="span6">
                        <button type="button" class="btn span12" id="update-basket">Update Basket</button>                        
                    </div>
                    <div class="span6 text-align-center">
                        @if (Model.CanEnterPaymentFlow)
                        {
                            <a class="generic-button big-red-gradient span12" href="@(UniquePageHelper.GetUrl<MrCMS.Web.Apps.Ecommerce.Pages.EnterOrderEmail>())">Checkout</a>
                        }
                    </div>
                </div>
                

            </div>
        </div>
        

    }
    <!-- TODO: styling of this paypal-->
    <div class="row-fluid">
        <div class="pull-right">
            @if (Model.CanUsePayPalExpress)
            {
                using (Html.BeginForm("SetExpressCheckout", "PayPalExpressCheckout", FormMethod.Post))
                {
                    <input type="image" src="https://www.paypalobjects.com/en_GB/i/btn/btn_xpressCheckout.gif" />
                }
            }
        </div>
    </div>
</div>

@{ Html.IncludeScript("~/Apps/Ecommerce/Content/Scripts/custom/cart.js"); }